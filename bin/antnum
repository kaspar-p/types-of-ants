#!/bin/bash

set -euo pipefail

function error() {
  echo -e "$1" > /dev/stderr
  exit 1
}

function usage() {
  error "Usage: $0 [-h] <host-or-num>
  Prints the ant worker number at the end of the identifier, e.g. 000
  
  host-or-num:    antworker000.hosts.typesofants.org, antworker000, 000

  -h: Display this help text.
"
}

function parse_short() {
  local host="$1"

  if [[ -z "$host" ]]; then
    error "[ERROR] Need hostname argument! For example:
      - antworker000.hosts.typesofants.org
      - antworker000
      - 000"
  elif [[ ${#host} -gt 12 ]]; then
    # Then this format is "antworkerxyz.hosts.typesofants.org"
    local arr_host=("${host//.hosts.typesofants.org/}")
    host="${arr_host[0]}"
    local arr_host=("${host//antworker/}")
    host="${arr_host[0]}"
  elif [[ ${#host} -gt 3 ]]; then
    # Then this format is "antworkerxyz"
    local arr_host=("${host//antworker/}")
    host="${arr_host[0]}"
  else
    # Then this format is "xyz"
    host="$host"
  fi

  echo "$host"
}

while getopts ":h" option; do
   case $option in
      h) usage ;;
      \?) usage ;;
   esac
done

parse_short "$@"

exit 0
